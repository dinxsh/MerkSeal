#!/usr/bin/env node

/**
 * Certificate of Authenticity Generator
 * Generates a PDF certificate for notarized documents
 */

const fs = require('fs');
const path = require('path');

// Parse command line arguments
const args = process.argv.slice(2);
const getArg = (flag) => {
    const index = args.indexOf(flag);
    return index !== -1 ? args[index + 1] : null;
};

const batchId = getArg('--batch-id');
const mantleBatchId = getArg('--mantle-batch-id');
const txHash = getArg('--tx-hash');
const documents = getArg('--documents');

if (!batchId || !mantleBatchId || !txHash || !documents) {
    console.error('Usage: node generate-certificate.js \\');
    console.error('  --batch-id <id> \\');
    console.error('  --mantle-batch-id <id> \\');
    console.error('  --tx-hash <hash> \\');
    console.error('  --documents "Doc1, Doc2"');
    process.exit(1);
}

// Load batch metadata
const metadataPath = path.join(__dirname, '..', '..', 'batches', batchId, 'metadata.json');
let metadata;
try {
    metadata = JSON.parse(fs.readFileSync(metadataPath, 'utf8'));
} catch (error) {
    console.error(`Error loading metadata: ${error.message}`);
    process.exit(1);
}

// Generate certificate
const certificate = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        CERTIFICATE OF AUTHENTICITY
        Powered by MerkSeal on Mantle L2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Documents Notarized: ${documents}

Merkle Root: ${metadata.root}

Blockchain Proof:
  Network: Mantle Testnet
  Mantle Batch ID: ${mantleBatchId}
  Transaction: ${txHash}
  Timestamp: ${new Date().toISOString()}
  
Verify at: https://explorer.testnet.mantle.xyz/tx/${txHash}

This certificate proves that the above documents existed in their
current state at the recorded timestamp and have not been modified.

To verify authenticity:
1. Visit the transaction link above
2. Compare the Merkle root with the on-chain data
3. Run: cargo run -p client -- verify --batch-id ${batchId}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Generated by MerkSeal - Verifiable Storage on Mantle L2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`;

// Save certificate
const outputPath = path.join(__dirname, 'certificate-of-authenticity.txt');
fs.writeFileSync(outputPath, certificate);

console.log('âœ… Certificate generated successfully!');
console.log(`ğŸ“„ Saved to: ${outputPath}`);
console.log('');
console.log(certificate);
